# AI响应内容缺失问题修复

## 问题描述

**问题**: AI回复开头经常缺失部分内容，回复以"的具体问题。"或"请您："开头
**严重程度**: 🔴 Critical
**影响范围**: 所有聊天功能
**发现时间**: 2025-01-15 测试期间

## 问题表现

### 典型示例
```json
{
  "message": "的具体问题。\n请您：\n1. 提供之前的对话历史内容\n2. 明确说明您希望我回答的具体问题..."
}
```

### 问题特征
1. 回复开头缺失部分内容
2. 经常以"的具体问题。"开头
3. 或者以"请您："开头，但前面应该有更多内容
4. 问题在所有AI回复中都存在

## 问题分析

### 1. Q CLI输出分析

通过直接调试Q CLI，我发现Q CLI的原始输出是完整的：

```
> 你好！我是Amazon Q，由AWS构建的AI助手。我可以帮助你处理各种技术问题，包括：

• AWS服务和资源管理
• 代码编写和调试
...
```

但是我们的清理逻辑跳过了以">"开头的行，这导致了内容缺失。

### 2. 清理逻辑问题

在 `_should_skip_line` 方法中：

```python
def _should_skip_line(self, line: str) -> bool:
    skip_patterns = [
        lambda l: l.startswith(">"),  # 这里跳过了包含实际回复内容的行！
        lambda l: "/quit" in l,
        lambda l: l.startswith("q chat"),
        lambda l: "Welcome to" in l,
        lambda l: "Type /quit" in l,
    ]
```

**问题根源**：我们跳过了所有以">"开头的行，但Q CLI的实际回复内容也是以">"开头的！

## 修复方案

### 1. 改进行跳过逻辑

我需要更精确地识别哪些">"行应该跳过，哪些包含实际内容：